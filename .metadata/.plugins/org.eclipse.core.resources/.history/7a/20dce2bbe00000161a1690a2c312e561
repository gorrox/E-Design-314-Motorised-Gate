/*
 * global.c
 *
 *  Created on: Apr 11, 2016
 *      Author: trist
 */

#include "global.h"

/*
 * Transmits an array of 14 bits via IR LED
 * Uses Manchester RC5 encoding
 */
void transmit(uint16_t msg)
{
	static volatile uint8_t fullHalfBitCounter = frameHalfBitLength;
	static volatile uint8_t frameHalfBitCounter = frameHalfBitLength;
	volatile uint8_t bit; // buffer

	if (fullHalfBitCounter) // Busy transmitting
	{
		if (frameHalfBitCounter)
		{
			bit = (msg >> ((frameHalfBitCounter + 1)/2 -1)); //Data bit
			bit &= 0x1; //Lowest LSB
			modulate = (!bit ^ (frameHalfBitCounter%2));
			frameHalfBitCounter--;
		}
		else
		{
			modulate = 0;
		}
		fullHalfBitCounter--;
	}
	else // Not busy transmitting
	{
		// Reset
		fullHalfBitCounter = fullHalfBitLength;
		frameHalfBitCounter = frameHalfBitLength;
		/*
		if (!IR_BUTTON_TX)
		{
			ir_txMessage |= 0x800;
		}
		else
		{
			ir_txMessage = ir_txMessage_default;
			R_TAU0_Channel3_Stop();
			R_INTC1_Start();
			R_INTC2_Start();
		}
		*/
	}

}
